<?php $__env->startSection("contentadmin"); ?>
<script>
    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth() + 1; //January is 0!
    var yyyy = today.getFullYear();

    if (dd < 10) {
        dd = '0' + dd
    }

    if (mm < 10) {
        mm = '0' + mm
    }

    today = mm + '/' + dd + '/' + yyyy;
    function showkhuyenmai() {
        jQuery("#datepicker").val('');
        jQuery("#datepicker1").val('');
        jQuery("#datepicker").datepicker("option", "minDate", today);
        jQuery("#datepicker1").datepicker("option", "minDate", today);
        jQuery("#book").toggle();
    }
    function checkngaykhuyenmai() {
        jQuery("#datepicker1").datepicker("option", "minDate", jQuery("#datepicker").val());

    }
</script>
<div class="contentwrapper">
    <div class="subcontent">
        <div class="contenttitle2">
            <h3>QUẢN LÝ KHO HÀNG</h3>
        </div>
    </div>
    <form  class="stdform" action="<?php echo URL::action("ProductController@postThemMoi"); ?>" method="post">
        <p>
            <label>Tên sản phẩm</label>
            <span class="field"><input type="text" name="nameProduct" id="nameProduct" class="longinput" /></span>
        </p>
        <p>
            <label>Mã sản phẩm</label>
            <span class="field"><input type="text" name="productCode" class="smallinput" /></span>
            <small class="desc">Ví dụ : JEAN-1029, AO-1292 .</small>
        </p>
        <p>
            <label>Nhóm sản phẩm</label>
            <span class="field">
                <select name="productGroup" id="selection2">
                    <?php if(isset($arrCatProduct)): ?>
                    <?php foreach($arrCatProduct as $item): ?>
                    <?php
                    if ($item->cateParent == 0) {
                        ?>
                        <option value="<?php echo $item->id; ?>"><?php echo $item->cateName; ?></option>
                        <?php
                        foreach ($arrCatProduct as $item1) {
                            if ($item1->cateParent == $item->id) {
                                echo '<option value="' . $item1->id . '" >-- ' . $item1->cateName . '</option>';
                            }
                        }
                    }
                    ?>
                    <?php endforeach; ?>
                    <?php endif; ?>
                </select>
            </span>
        </p>
        <p>
            <label>Mô tả sản phẩm</label>
            <span class="field"><textarea cols="80" rows="5"  id="location3" class="ckeditor" name="productDetail" placeholder="Nội dung trả lời"></textarea></textarea></span>

        </p>
        <p>
            <label>Chi tiết sản phẩm</label>
        <div id="tabs">
            <ul>
                <li><a href="#tabs-1">Thuộc tính sản phẩm</a></li>
                <li><a href="#tabs-2">Số lượng</a></li>   
                <li><a href="#tabs-3">Ảnh sản phẩm</a></li>   
                <li><a href="#tabs-4">Phân loại</a></li>   
            </ul>
            <div id="tabs-1">
                <p>
                    <textarea cols="80" rows="3"  id="location3" class="ckeditor" name="productAttributes" placeholder="Nội dung trả lời"></textarea></textarea>
                </p>

            </div>
            <div id="tabs-2">
                <script type="text/javascript">
                    var a = 0;
                    function  onfor(id) {
                        a = jQuery('#mausanpham-' + id).val();
                    }
                    function  onchangeselec(id) {

                        var rowCount = jQuery('#myTable tr').length;
                        var check = true;
                        for (i = 1; i <= rowCount - 1; i++) {
                            if (i != id) {
                                if (jQuery('#mausanpham-' + i).val() == jQuery('#mausanpham-' + id).val() && jQuery('#sizesanpham-' + i).val() == jQuery('#sizesanpham-' + id).val()) {
                                    check = false;
                                }
                            }
                        }
                        if (check == true) {
                            return  true;
                        } else {
                            jQuery('#mausanpham-' + id).val(a)
                            jAlert('Phần tử đã thêm đã tồn tại', 'Thông báo');
                        }
                    }

                    var b = 0;
                    function  onfor1(id) {
                        b = jQuery('#sizesanpham-' + id).val();
                    }
                    function  onchangeselec1(id) {

                        var rowCount = jQuery('#myTable tr').length;
                        var check = true;
                        for (i = 1; i <= rowCount - 1; i++) {
                            if (i != id) {
                                if (jQuery('#mausanpham-' + i).val() == jQuery('#mausanpham-' + id).val() && jQuery('#sizesanpham-' + i).val() == jQuery('#sizesanpham-' + id).val()) {
                                    check = false;
                                }
                            }
                        }
                        if (check == true) {
                            return  true;
                        } else {
                            jQuery('#sizesanpham-' + id).val(b)
                            jAlert('Phần tử đã thêm đã tồn tại', 'Thông báo');
                        }
                    }
                    function themsoluong(mausac, size, soluong) {

                        var rowCount = jQuery('#myTable tr').length;
                        var check = true;
                        for (i = 1; i <= rowCount - 1; i++) {
                            if (jQuery('#mausanpham-' + i).val() == mausac && jQuery('#sizesanpham-' + i).val() == size) {
                                check = false;
                            }
                        }

                        if (check == false)
                        {
                            jAlert('Phần tử đã thêm đã tồn tại', 'Thông báo');
                        } else {
                            if (soluong == '') {
                                jAlert('Bạn vui lòng thêm số lượng sản phẩm', 'Thông báo');
                            } else {
                                var html = '<tr id="row-' + rowCount + '"><td><select  name="mausacsanpham[]" id="mausanpham-' + rowCount + '"  onfocus="onfor(' + rowCount + ')" onchange="onchangeselec(' + rowCount + ')"> <?php if(isset($arrColor)): ?><?php foreach($arrColor as $item): ?><option value="<?php echo $item->id; ?>" style="background: <?php echo $item->colorCode; ?>"><?php echo $item->colorName; ?></option><?php endforeach; ?><?php endif; ?></select></td><td><select name="sizesanphamr[]" id="sizesanpham-' + rowCount + '" onfocus="onfor1(' + rowCount + ')" onchange="onchangeselec1(' + rowCount + ')">  <?php if(isset($arrSize)): ?><?php foreach($arrSize as $item): ?><option value="<?php echo $item->id; ?>" ><?php echo $item->sizeName; ?></option><?php endforeach; ?><?php endif; ?></select></td> <td class="center"><input type="text" id="soluongsanpham-' + rowCount + '" name="soluongsanpham[]" style="smallinput"/></td><td class="center"><a href="javascript:void(0);" onclick="xoasanpham(\'row-' + rowCount + '\')" class="btn btn4 btn_trash"></a></td></tr>';
                                jQuery('#themsoluong').append(html);
                                setTimeout(jQuery('#mausanpham-' + rowCount).val(mausac), 100);
                                setTimeout(jQuery('#sizesanpham-' + rowCount).val(size), 100);
                                setTimeout(jQuery('#soluongsanpham-' + rowCount).val(soluong), 100);
                            }
                        }
                    }
                    function xoasanpham(id) {
                        jConfirm('Bạn có chắc chắn muốn xóa ?', 'Thông báo', function(r) {
                            if (r == true) {
                                jQuery('#' + id).remove();
                            } else {
                                return false;
                            }
                        });
                    }
                </script>
                <table  cellpadding="0" cellspacing="0" border="0" class="stdtable" id="myTable">
                    <colgroup>

                        <col class="con1" style="width: 30%;" />
                        <col class="con0"  style="width: 30%;"/>
                        <col class="con1" style="width: 30%;" />
                        <col class="con0" style="width: 10%;" />
                    </colgroup>
                    <thead>
                        <tr>

                            <th class="head1">Màu sắc</th>
                            <th class="head0">Size</th>
                            <th class="head1">Số lượng</th>    
                            <th class="head1">Xóa</th>  
                        </tr>
                    </thead>
                    <tbody id="themsoluong">

                    </tbody>
                </table>
                <p>
                    <label>Màu sắc</label>
                    <span class="field">
                        <select  name="mausacproduct" id="mausacproduct">
                            <?php if(isset($arrColor)): ?>
                            <?php foreach($arrColor as $item): ?>
                            <option value="<?php echo $item->id; ?>" style="background: <?php echo $item->colorCode; ?>"><?php echo $item->colorName; ?></option>
                            <?php endforeach; ?>
                            <?php endif; ?>
                        </select>
                    </span>
                </p>
                <p>
                    <label>Size</label>
                    <span class="field">
                        <select name="sizeproduct" id="sizeproduct">
                            <?php if(isset($arrSize)): ?>
                            <?php foreach($arrSize as $item): ?>
                            <option value="<?php echo $item->id; ?>" ><?php echo $item->sizeName; ?></option>
                            <?php endforeach; ?>
                            <?php endif; ?>
                        </select>
                    </span>
                </p>
                <p>
                    <label>Số lượng</label>
                    <span class="field"><input type="text" name="soluongproduct" id="soluongproduct" class="longinput" /></span>
                </p>
                <input type="button" class="stdbtn btn_orange" value="Thêm loại" onclick="themsoluong(jQuery('#mausacproduct').val(), jQuery('#sizeproduct').val(), jQuery('#soluongproduct').val());"/>
            </div>
            <div id="tabs-3">
                <script type="text/javascript">

                    function BrowseServer(startupPath, functionData)
                    {
                        // You can use the "CKFinder" class to render CKFinder in a page:
                        var finder = new CKFinder();

                        // The path for the installation of CKFinder (default = "/ckfinder/").
                        // finder.basePath = '../';

                        //Startup path in a form: "Type:/path/to/directory/"
                        finder.startupPath = startupPath;
                        // Name of a function which is called when a file is selected in CKFinder.
                        finder.selectActionFunction = SetFileField;

                        // Additional data to be passed to the selectActionFunction in a second argument.
                        // We'll use this feature to pass the Id of a field that will be updated.
                        finder.selectActionData = functionData;
                        // Launch CKFinder
                        finder.popup();
                    }

// This is a sample function which is called when a file is selected in CKFinder.
                    function SetFileField(fileUrl, data)
                    {
                        var sFileName = this.getSelectedFile().name
                        var d = new Date();
                        var urlImg = '<div id="image-' + d.getTime() + '"><img src="<?php echo Asset('timthumb.php'); ?>?src=http://' + window.location.hostname + fileUrl + '&w=100&h=100&zc=0&q=100" title="http://' + window.location.hostname + fileUrl + '" width="100" height="100"/><a href="javascript:void(0);" onclick="xoaanhthum(\'image-' + d.getTime() + '\');" class="delete" title="Delete image">x</a></div>';
                        document.getElementById('thumbnails').innerHTML += urlImg;
                        returnurlimg();
                        //   document.getElementById(data["selectActionData"]).value = fileUrl;
                    }
                    function xoaanhthum(id) {
                        document.getElementById(id).remove();
                        returnurlimg();

                    }
                    function returnurlimg() {
                        var images = jQuery("#thumbnails").find("img").map(function() {
                            return this.title;
                        }).get();
                        jQuery("#xImagePath").val(images);
                    }
                </script>

                <div id="thumbnails"></div>
                <input id="xImagePath" name="ImagePath" type="hidden" />
                <div class="clear"></div>
                <input type="button" value="Thêm ảnh" class="stdbtn btn_orange" onclick="BrowseServer('Images:/', 'xImagePath');" />
            </div>
            <div id="tabs-4">
                <p>
                    <label>Chọn loại</label>
                    <span class="field">
                        <select name="select2[]" multiple="multiple" size="10">
                            <?php if(isset($arrmuti)): ?>
                            <?php foreach($arrmuti as $item): ?>
                            <option value="<?php echo $item->id; ?>" ><?php echo $item->catName; ?></option>
                            <?php endforeach; ?>
                            <?php endif; ?>
                        </select>
                    </span>
                    <small class="desc">Bạn có thể chọn nhiều loại bằng cách giữ CTRL rồi chọn</small>
                </p>
            </div>
        </div>
        </p>
        <p>
            <label>Giá sản phẩm </label>
            <span class="field"><input type="text" name="productPrice" class="smallinput" /></span>
        </p>
        <p>
            <label>Giá khuyến mại </label>
            <span class="field"><input type="text" name="productPriceSales" class="smallinput" />  &nbsp;<a href="javascript:void(0);" onclick="showkhuyenmai()
                            ;">Thời gian khuyến mại</a></span>
            <small class="desc">Không khuyến mại để mặc định là trống .</small>
        </p>
        <p id="book" style="display: none;">
            <label>Thời gian khuyến mại </label>
            <span class="field">Từ&nbsp;<input type="text" name="datetosales" id="datepicker" class="smallinput" onchange="checkngaykhuyenmai()" />&nbsp;&nbsp;Đến&nbsp;<input id="datepicker1" type="text" name="datefromsales" class="smallinput" /> </span>
        </p>
        <p>
            <label>Đường dẫn tĩnh </label>
            <span class="field"><input type="text" name="productslug" class="smallinput" /></span>
        </p>
        <p>
            <label>Tags</label>
            <span class="field">
                <input name="producttags" id="tags" class="longinput" />
                <small class="desc">Tag cách nhau bằng dấu phẩy.</small>
            </span>
        </p>
        <p>
            <label>Nhà sản xuất</label>
            <span class="field">
                <select name="manufacture" id="selection2">
                    <?php if(isset($arrManu)): ?>
                    <?php foreach($arrManu as $item): ?>
                    <option value="<?php echo $item->id; ?>"><?php echo $item->manufacturerName; ?></option>
                    <?php endforeach; ?>
                    <?php endif; ?>
                </select>
            </span>
        </p>
        <button class="submit radius2" value="Gửi phản hồi">Gửi phản hồi </button>
    </form>
</div>
<?php $__env->stopSection(); ?>
<?php echo $__env->make("templateadmin2.mainfire", array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>