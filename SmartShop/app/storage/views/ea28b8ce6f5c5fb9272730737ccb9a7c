<?php $__env->startSection("contentadmin"); ?>
<script>



    function xoasanpham(id) {
        jConfirm('Bạn có chắc chắn muốn xóa ?', 'Thông báo', function(r) {
            if (r == true) {
                var request = jQuery.ajax({
                    url: "<?php echo URL::action('\BackEnd\MenuController@postDeleteMenu'); ?>?id=" + id,
                    type: "POST",
                    dataType: "html"
                });
                request.done(function(msg) {
                    jQuery('#tableproduct').html(msg);
                });
                return false;
            } else {
                return false;
            }
        })
    }

    function kichhoat(id, stus) {
        var request = jQuery.ajax({
            url: "<?php echo URL::action('\BackEnd\MenuController@postMenuActive'); ?>?id=" + id + '&status=' + stus,
            type: "POST",
            dataType: "html"
        });
        request.done(function(msg) {
            jQuery('#tableproduct').html(msg);
        });
        return true;
    }
</script>

<script>
    jQuery(document).ready(function() {
        jQuery('.external').hide();
        jQuery('#catenews').hide();
        jQuery('#cateproduct').hide();
        jQuery('#internal').hide();
        jQuery('#url').change(function() {
            if (jQuery('#url').val() == '1') {
                jQuery('#internal').hide();
                jQuery('.external').hide();
                jQuery('#catenews').hide();
                jQuery('#cateproduct').hide();
                jQuery('#home').show();
            } else if (jQuery('#url').val() == '2') {
                jQuery('#internal').show();
                jQuery('.external').hide();
                jQuery('#catenews').hide();
                jQuery('#cateproduct').hide();
                jQuery('#home').hide();
            } else if (jQuery('#url').val() == '3') {
                jQuery('#internal').hide();
                jQuery('.external').show();
                jQuery('#catenews').hide();
                jQuery('#cateproduct').hide();
                jQuery('#home').hide();
            } else if (jQuery('#url').val() == '4') {
                jQuery('#internal').hide();
                jQuery('.external').hide();
                jQuery('#catenews').show();
                jQuery('#cateproduct').hide();
                jQuery('#home').hide();
            } else if (jQuery('#url').val() == '5') {
                jQuery('#internal').hide();
                jQuery('.external').hide();
                jQuery('#catenews').hide();
                jQuery('#cateproduct').show();
                jQuery('#home').hide();
            }
        });
        jQuery('#cateproduct').change(function() {
            jQuery("#urlValue").val(jQuery('#cateproduct').val());
        });
        jQuery('#catenews').change(function() {
            jQuery('#urlValue').val(jQuery('#catenews').val());
        });
        jQuery('#parent').change(function() {
            jQuery('#parentvalue').val(jQuery('#parent').val());

        });


        jQuery('#externalValue').change(function() {
            jQuery('#urlValue').val(jQuery('#externalValue').val());
        });
        jQuery('#internal').change(function() {
            jQuery("#urlValue").val(jQuery('#internal').val());
        });
        jQuery('#home').change(function() {
            jQuery("#urlValue").val(jQuery('#home').val());
        });

        jQuery("#addMenu").validate({
            rules: {
                menuName: {
                    required: true

                },
                urlValue: {
                    required: true

                },
                menuParent: {
                    required: true,
                    number: true
                },
                menuPosition: {
                    required: true,
                    number: true
                }

            },
            messages: {
                menuName: {
                    required: 'Tên là trường bắt buộc'

                },
                urlValue: {
                    required: 'Đường dẫn trường bắt buộc'

                },
                menuParent: {
                    required: 'Vui lòng nhập parent',
                    number: 'Giá trị phải là số'
                },
                menuPosition: {
                    required: 'Vui lòng nhập vị trí ',
                    number: 'Giá trị phải là số'
                }
            }
        });
    });
</script>
<style>
    form select{
        margin-left:6px;
    }
</style>
<div class="pageheader notab">
    <h1 class="pagetitle">Quản lý menu</h1>
    <span class="pagedesc">Quản lý các menu</span>
</div>

<div class="contentwrapper">
    <?php if(isset($msg)): ?>
    <div class="notibar msgalert">
        <a class="close"></a>
        <p><?php echo $msg; ?></p>
    </div>
    <?php endif; ?>
    <div class="subcontent">
        <div class="contenttitle2">
            <h3>Bảng quản lý menu</h3>
        </div>

        <div class="tableoptions">



        </div>
        <table cellpadding="0" cellspacing="0" border="0" id="table2" class="stdtable stdtablecb">
            <colgroup>
                <col class="con0" style="width: 3%">
                <col class="con0" style="width: 10%">
                <col class="con1" style="width: 15%">
                <col class="con0" style="width: 10%">
                <col class="con1" style="width: 10%">
                <col class="con0" style="width: 10%">                
                <col class="con1" style="width: 10%">
                <col class="con0" style="width: 15%">
            </colgroup>
            <thead>
                <tr>
                    <th class="head1"></th>
                    <th class="head1">Tên menu</th>
                    <th class="head0">Đường dẫn</th>
                    <th class="head1">Parent</th>
                    <th class="head0">Vị trí</th>
                    <th class="head1">Khởi tạo</th>
                    <th class="head0">Tình trạng</th>
                    <th class="head1">Chức năng</th>
                </tr>  
            </thead>

            <tbody id="tableproduct"> 


                <?php if(isset($arrMenu)): ?>
                <?php foreach($arrMenu as $item): ?>
                <tr> 
                    <td><input type="hidden" value="<?php echo $item->id; ?>"/></td> 
                    <td><?php if($item->menuParent ==0): ?> <strong> <?php endif; ?> <label value="page"><?php if($item->menuParent !=0): ?> &nbsp;-&nbsp; <?php endif; ?> <a href="<?php echo URL::action('\BackEnd\MenuController@getMenuEdit'); ?>/<?php echo $item->id; ?>"><?php echo str_limit( $item->menuName, 30, '...'); ?></a></label><?php if($item->menuParent ==0): ?> </strong> <?php endif; ?></td>
                    <td><label value="page"><?php echo str_limit($item->menuURL, 30, '...'); ?> </label></td> 
                    <td><label value="page"><?php if ($item->menuParent == 0 ): ?> <?php echo 'Cha'; ?> <?php else: ?> <?php echo str_limit($item->menuParentName , 30, '...'); ?> <?php endif; ?> </label></td> 
                    <td><label value="page"><?php echo $item->menuPosition; ?> </label></td> 
                    <td><label value="page"></label><?php echo date('d/m/Y h:i:s', $item->time); ?></td> 
                    <td>
                        <label value="page">
                            <?php
                            if ($item->status == 0) {
                                echo "chờ kích hoạt";
                            } else if ($item->status == 1) {
                                echo "đã kích hoạt";
                            } else if ($item->status == 2) {
                                echo "đã xóa";
                            }
                            ?>
                        </label>
                    </td> 
                    <td>

                        <?php if($item->status=='2'): ?>
                        <a href="javascript: void(0)" onclick="kichhoat(<?php echo $item -> id; ?>, 0)" class="btn btn4 btn_world" title="Chờ kích hoạt"></a>
                        <?php endif; ?>
                        <?php if($item->status=='0'): ?>
                        <a href="javascript: void(0)" onclick="kichhoat(<?php echo $item -> id; ?>, 1)" class="btn btn4 btn_flag" title="Kích hoạt"></a>
                        <?php endif; ?>
                        <?php if($item->status!='2'): ?>
                        <a href="javascript: void(0)" onclick="xoasanpham(<?php echo $item -> id; ?>)" class="btn btn4 btn_trash" title="Xóa"></a>
                        <?php endif; ?>
                    </td> 
                </tr> 
                <?php endforeach; ?>
                <?php if($link!=''): ?>
                <tr>
                    <td colspan="8"><?php echo $link; ?></td>
                </tr>
                <?php endif; ?>

                <?php endif; ?>
            </tbody>
        </table>


    </div>


    <div class="contenttitle2">
        <h3>Them/sua menu</h3>
    </div>
    <form class="stdform stdform2" id="addMenu" method="post" action="<?php if(isset($arrayMenu)): ?> <?php echo URL::action('\BackEnd\MenuController@postUpdateMenu'); ?> <?php else: ?> <?php echo URL::action('\BackEnd\MenuController@postAddMenu'); ?><?php endif; ?>">

        <p>
            <input type="hidden" name="idmenu" id="idmanuf" value="<?php if(isset($arrayMenu)): ?><?php echo $arrayMenu->id; ?><?php endif; ?>"/>
            <input type="hidden" name="status" id="status" value="<?php if(isset($arrayMenu)): ?><?php echo $arrayMenu->status; ?><?php endif; ?>"/>

        </p>
        <p>
            <label>Tên Menu</label>
            <span class="field">
                <input type="text" id="menuName" name="menuName" placeholder="Nhập tên menu" value="<?php if(isset($arrayMenu)): ?><?php echo $arrayMenu->menuName; ?><?php endif; ?>" class="longinput">
            </span>

        </p>

        <p>
            <label>Đường dẫn</label>
            <span class="field">
                <input type="text" id="urlValue" name="urlValue" value="<?php if(isset($arrayMenu)): ?><?php echo $arrayMenu->menuURL; ?><?php else: ?> <?php echo Asset('fontend'); ?> <?php endif; ?>"/>
                <select id="url">
                    <option value="1">Trang chủ</option>
                    <option value="2">Trang trong</option>
                    <option value="3">Trang ngoài</option>
                    <option value="4">Danh mục tin tức</option>
                    <option value="5">Danh mục sản phẩm</option>                    
                </select><br/>  
                <select name="home" id="home" size="5">                    
                    <option value="<?php echo action('HomeController@getHome'); ?>">Trang chủ</option>

                </select>
                <select name="internal" id="internal" size="5">                    
                    <?php if(isset($menu)): ?>
                    <?php foreach($menu as $item): ?>
                    <option value="'PageController@getPageBySlug'?slug=<?php echo $item->pageSlug; ?>"><?php echo $item->pageName; ?></option>
                    <?php endforeach; ?>
                    <?php endif; ?>
                </select>
                <select name="catenews" id="catenews" size="5">
                    <option value="NewsController@getNewsView">Tất cả tin tức</option>
                    <?php if(isset($catenews)): ?>
                    <?php foreach($catenews as $item): ?>
                    <option value="------------">
                        <?php if($item->catenewsParent ==0): ?>  <strong>
                        <?php endif; ?> <?php if($item->catenewsParent !=0): ?> &nbsp;-&nbsp;
                        <?php endif; ?> <?php echo $item->catenewsName; ?> <?php if($item->catenewsParent ==0): ?>
                    </strong> <?php endif; ?></option>
                    <?php endforeach; ?>
                    <?php endif; ?>
                </select>
                <select name="cateproduct" id="cateproduct" size="5">
                    <option value="------------">Tất cả sản phẩm</option>
                    <?php if(isset($catepro)): ?>
                    <?php foreach($catepro as $item): ?>
                    <option value="">------------</option>
                    <?php endforeach; ?>
                    <?php endif; ?>
                </select>                
                <label class="external" style="margin-right:-185px;margin-left: -10px;">URL:</label>
                <input type="text" class="external" id="externalValue" style="width: 40%;margin-top:10px "/>

            </span>
        </p>

        <p>
            <label>Parent</label>
            <span class="field">
                <select name="parent" id="parent">
                    <option value="0">Khong</option>
                    <?php
                    foreach ($arrMenu as $item) {
                        if ($item->menuParent == 0) {
                            $selec = '';
                            if (isset($arrayMenu) && $item->id == $arrayMenu->menuParent) {
                                $selec = 'selected';
                            }
                            echo '<option value="' . $item->id . '" ' . $selec . '> ' . $item->menuName . '</option>';
                        }
                    }
                    ?>                    
                </select>
                <input type="hidden" id='parentvalue' value="0" name="parentvalue"/>

            </span>
        </p> 
        <p>
            <label>Vị trí</label>
            <span class="field">
                <input type="text" name="menuPosition" placeholder="Nhập vị trí" value="<?php if(isset($arrayMenu)): ?><?php echo $arrayMenu->menuPosition; ?><?php endif; ?>" class="longinput">

            </span>
        </p> 

        <p>
            <label>Trạng thái</label>
            <span class="field">
                <select name="status">
                    <option value="0" <?php if(isset($arrayMenu)&& $arrayMenu->status==0): ?>selected<?php endif; ?> >Chờ kích hoạt</option>
                    <option value="1" <?php if(isset($arrayMenu)&& $arrayMenu->status==1): ?>selected<?php endif; ?>>Kích hoạt</option>
                    <option value="2" <?php if(isset($arrayMenu)&& $arrayMenu->status==2): ?>selected<?php endif; ?>>Xóa</option>
                </select>
            </span>
        </p>

        <p class="stdformbutton">
            <button class="submit radius2"><?php if(isset($arrayMenu)): ?>Cập nhật <?php else: ?> Thêm mới <?php endif; ?></button>
            <input type="reset" class="reset radius2" value="Làm lại">
        </p>
    </form>
</div>
<?php $__env->stopSection(); ?>


<?php echo $__env->make("templateadmin2.mainfire", array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>