<?php $__env->startSection("titleAdmin"); ?>
<?php if(isset($dataProject)): ?>
<?php echo Lang::get('backend/title.project.edit'); ?>
<?php else: ?>
<?php echo Lang::get('backend/title.project.add'); ?>
<?php endif; ?>
<?php $__env->stopSection(); ?>
<?php $__env->startSection("contentadmin"); ?>
<script>
    jQuery(document).ready(function() {
<?php
if (isset($dataProject)) {
    $tag = explode(',', $dataProject->img);
    $i = 1;
    foreach ($tag as $item) {
        $urlimg = Timthumb::link($item, 100, 100, 0);
        ?>
                var urlImg = '<span style="padding-top:10px" id="image-<?php echo $i; ?>">' +
                        '<img src="<?php echo Asset($urlimg); ?>" width="100" height="100"/>' +
                        '<a href="javascript:void(0);" ' +
                        'onclick="xoaanhthum(\'image-<?php echo $i; ?>\');" class="delete" title="<?php echo Lang::get("button.delete"); ?>">x</a></span>';
                var urlImgno = '<span style="padding-top:10px" id="n-image-<?php echo $i; ?>">' +
                        '<a href="<?php echo $item; ?>"></a></span>';
                document.getElementById('thumbnails').innerHTML += urlImg;
                document.getElementById('noThumb').innerHTML += urlImgno;
        <?php
        $i++;
    }
    ?>
            returnurlimg();
<?php }
?>
        jQuery("#addProjectForm").validate({
            rules: {
                projectName: {required: true},
                projectDescription: {required: true},
                projectContent: {required: true}
            },
            messages: {
                projectName: {required: '<?php echo Lang::get('jquery.project.name'); ?>'},
                projectDescription: {required: '<?php echo Lang::get('jquery.project.description'); ?>'},
                projectContent: {required: '<?php echo Lang::get('jquery.project.content'); ?>'}
            }
        });
    });
    function BrowseServer(startupPath, functionData)
    {
        // You can use the "CKFinder" class to render CKFinder in a page:
        var finder = new CKFinder();
        // The path for the installation of CKFinder (default = "/ckfinder/").
        // finder.basePath = '../';

        //Startup path in a form: "Type:/path/to/directory/"
        finder.startupPath = startupPath;
        // Name of a function which is called when a file is selected in CKFinder.
        finder.selectActionFunction = SetFileField;
        // Additional data to be passed to the selectActionFunction in a second argument.
        // We'll use this feature to pass the Id of a field that will be updated.
        finder.selectActionData = functionData;
        // Launch CKFinder
        finder.popup();
    }
    var i = 0;
// This is a sample function which is called when a file is selected in CKFinder.
    function SetFileField(fileUrl, data)
    {
        var sFileName = this.getSelectedFile().name + i;
        var urlImg = '<span id="image-' + sFileName + '"><img src="<?php echo Asset('pubweb.vn/100/100/0') ?>/' + fileUrl + '" width="100" height="100"/><a href="javascript:void(0); " onclick="xoaanhthum(\'image-' + sFileName + '\');" class="delete" title="Delete image">x</a></span>';
        document.getElementById('thumbnails').innerHTML += urlImg;
        var urlImgNoThumb = '<span id="n-image-' + sFileName + '"><a href="' + fileUrl + '"></a></span>';
        document.getElementById('noThumb').innerHTML += urlImgNoThumb;
        i++;
        returnurlimg();
        //   document.getElementById(data["selectActionData"]).value = fileUrl;
    }

    function xoaanhthum(id) {
        document.getElementById(id).remove();
        document.getElementById('n-' + id).remove();
        returnurlimg();
    }

    function returnurlimg() {
        var images = jQuery("#noThumb").find("a").map(function() {
            return this.href;
        }).get();
        jQuery("#xImagePath").val(images);
    }
</script>
<script>


</script>

<div class="contentwrapper">
    <div class="subcontent">
        <div class="contenttitle2" id="editProject">
            <h3 class="uppercase">
                <?php if(isset($dataProject)): ?>
                <?php echo Lang::get('backend/title.project.edit'); ?>
                <?php else: ?>
                <?php echo Lang::get('backend/title.project.add'); ?>
                <?php endif; ?>
            </h3>
        </div>
        <?php echo $__env->make('backend.alert', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
        <?php if(isset($dataProject)): ?>
        <?php echo Form::model($dataProject, array('action'=>array('\BackEnd\ProjectController@postUpdateProject', $dataProject->id), 'id'=>'addProjectForm', 'class'=>'stdform')); ?>
        <?php
        $dataProject->from = date('m/d/Y', $dataProject->from);
        $dataProject->to = date('m/d/Y', $dataProject->to);
        ?>
        <?php else: ?>
        <?php echo Form::open(array('action'=>'\BackEnd\ProjectController@postAddProject', 'id'=>'addProjectForm', 'class'=>'stdform')); ?>
        <?php endif; ?>
        <p>
            <?php echo Form::hidden('id', null, array('id'=>'idproject')); ?>
            <?php echo Form::hidden('status', null, array('id'=>'status')); ?>
        </p>
        <p>
            <label><?php echo Lang::get('general.project_name'); ?></label>
            <span class="field">
                <?php echo Form::text('projectName', null, array('id'=>'projectName')); ?>
            </span>
        </p>
        <p>
            <label><?php echo Lang::get('general.date_begin'); ?></label>
            <span class="field">
                <?php echo Form::text('from', null, array('id'=>'datepicker', 'width'=>'100px')); ?>

            </span>
        </p>

        <p>
            <label><?php echo Lang::get('general.date_end'); ?></label>
            <span class="field">
                <?php echo Form::text('to', null, array('id'=>'datepicker1', 'width'=>'100px')); ?>
            </span>
        </p>

        <p>
            <label><?php echo Lang::get('general.description'); ?></label>
            <span class="field">
                <?php echo Form::textarea('projectDescription', null, array('id'=>'description', 'rows'=>5, 'cols'=>80, 'class'=>'ckeditor')); ?>
            </span>
        </p>

        <p>
            <label><?php echo Lang::get('general.content'); ?></label>
            <span class="field">
                <?php echo Form::textarea('projectContent', null, array('id'=>'content', 'rows'=>5, 'cols'=>80, 'class'=>'ckeditor')); ?>
        </p>

        <p>
            <label><?php echo Lang::get('general.image'); ?></label>

            <span class="field">           
                <input id="xImagePath" name="ImagePath" type="hidden"/>
                <span id="thumbnails"></span>
                <input type="button" value="<?php echo Lang::get('button.addImage'); ?>" class="stdbtn btn_orange" onclick="BrowseServer('Images:/', 'xImagePath');"/>
            </span>
            <span hidden="true" id="noThumb">
            </span>
        </p>
        <p>
            <label><?php echo Lang::get('general.status'); ?></label>
            <span class="field">
                <?php
                $selectData = Lang::get('general.data_status');
                unset($selectData['']);
                echo Form::select('status', $selectData);
                ?>
            </span>
        </p>
        <p class="stdformbutton">
            <button style="margin-left: 30px;" class="submit radius2"><?php if(isset($dataProject)): ?><?php echo Lang::get('button.update'); ?> <?php else: ?><?php echo Lang::get('button.add'); ?> <?php endif; ?></button>
            <input type="reset" class="reset radius2" value="<?php echo Lang::get('button.reset'); ?>">
        </p>
        <?php echo Form::close(); ?>
    </div>
</div>
<?php $__env->stopSection(); ?>
<?php echo $__env->make("backend.template", array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>